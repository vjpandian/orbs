version: 2.1

commands:
  aws-auth-setup:
    steps:
      - run: echo "hello"
      
  tf-init-plan-vpc:
    steps:
      - run:
           description: Run terraform init and plan for VPC Configuration
           name: terraform init & plan
           command: |
              cd <<pipeline.parameters.tf-workspace>>
              terraform init -input=false
              terraform plan -out tfapply -var="aws_region=$AWS_DEFAULT_REGION" \
                    -var="aws_access_key=$AWS_ACCESS_KEY_ID" \
                    -var="aws_secret_key=$AWS_SECRET_ACCESS_KEY"
